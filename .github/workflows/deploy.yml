name: Deploy

on:
 push:
 branches: [ "master" ]
 pull_request:
 branches: [ "master" ]

jobs:
 laravel-tests:

 runs-on: ubuntu-latest

 steps:
 - uses: shivammathur/setup-php@v2
 with:
 php-version: '8.2'
 - uses: actions/checkout@v3
 - name: Copy .env
 run: php -r "file_exists('.env') || copy('.env.example', '.env');"
 - name: Install Dependencies
 run: composer install --ignore-platform-reqs -q --no-ansi --no-interaction --no-scripts --no-progress --prefer-dist
 - name: Directory Permissions
 run: chmod -R 777 storage bootstrap/cache
 - name: Generate key
 run: php artisan key:generate


 build:

 runs-on: ubuntu-latest

 steps:
 - name: Checkout
 uses: actions/checkout@v2
 - name: Setup Node.js
 uses: actions/setup-node@v2-beta
 with:
 node-version: '20'
 check-latest: true
 - name: Install NPM dependencies
 run: npm install
 - name: Compile assets for build
 run: npm run build

 deploy:

 runs-on: ubuntu-latest

 steps:
 - name: Checkout
 uses: actions/checkout@v2
 - name: Deployment
 uses: appleboy/ssh-action@master
 with:
 host: ${{ secrets.SSH_HOST }}
 username: ${{ secrets.SSH_USERNAME }}
 password: ${{ secrets.SSH_PASSWORD }}
 port: 1157
 script: |
 cd /home/abdulkco/public_html/laravel/laravel-blog-app
 chmod +x deploy.sh
 ./deploy.sh
